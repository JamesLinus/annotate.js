<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="lib/jquery/jquery-ui.min.css" />
    <link rel="stylesheet" href="lib/Smoothness/jquery.ui.all.css" />
    <link rel="stylesheet" href="annotate.css" />

    <script type="text/javascript" src="lib/jquery/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="lib/jquery-ui.1.9m5.js"></script>
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>-->
    <script type="text/javascript" src="lib/underscore-min.js"></script>
    <script type="text/javascript" src="lib/backbone.js"></script>

    <script type="text/javascript" src="lib/hallo/hallo.js"></script>
    <script type="text/javascript" src="lib/hallo/format.js"></script>

    <script type="text/javascript" src="lib/jquery.rdfquery.debug.js"></script>
    <script type="text/javascript" src="lib/vie/vie-latest.debug.js"></script>

    <script type="text/javascript" src="lib/annotate.js"></script>

    <style>
		article {
			padding: 10px;
		}
        #loadingDiv {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>

    <script>
    if (window.JSON === undefined ) { 
        document.write('<' + 'script src="lib/json/json2.js">/script>"></' + 'script>');
    }
    $(document).ready(function(){ _.defer(function(){
        $('#loadingDiv')
        .hide()  // hide it initially
        .ajaxStart(function() {
            $(this).show();
        })
        .ajaxStop(function() {
            $(this).hide();
        });
        var z = new VIE();
        z.use(new z.StanbolService({
            url : "http://dev.iks-project.eu:8081",
            enhancerUrlPostfix: "/enhancer/chain/austrian-national-library",
            entityhubSite: "anl",
            proxyDisabled: true
        }));

        // make the content element editable
        $('.content').hallo({
            plugins: {
//              'halloformat': {}
            },
            editable: true
        });
        function enable(){
            $('.content')
            .each(function(){
                $(this)
                .annotate('enable', function(success){
                    if(success){
                        $('.enhanceButton')
                        .button('enable')
                        .button('option', 'label', 'Done');

                        $('.acceptAllButton')
                        .show()
                        .button('enable')
                    } else {
                        $('.enhanceButton')
                        .button('enable')
                        .button('option', 'label', 'error, see the log.. Try to enhance again!');
                    }
                });
            });
        }

        function instantiate(){
            $('.content').annotate({
                vie: z,
                // typeFilter: ["http://dbpedia.org/ontology/Place", "http://dbpedia.org/ontology/Organisation", "http://dbpedia.org/ontology/Person"],
                debug: true,
                //autoAnalyze: true,
                showTooltip: true,
                decline: function(event, ui){
                    console.info('decline event', event, ui);
                },
                select: function(event, ui){
                    console.info('select event', event, ui);
                    var entityUri = ui.linkedEntity.uri;
                    z.load({entity: entityUri}).using("stanbol").execute().success(function(res){
                        var myEntity = _(res).detect(function(e){return e.getSubject().replace(/^<|>$/g, "") === entityUri;});
                        var imageuri = myEntity.get('dcterms:identifier');
		                var newImage = document.createElement("img");
		                $(newImage).attr("src", imageuri);
		                $(newImage).attr("width", "300");
		                $('#images').append(newImage);
                    });
                },
                remove: function(event, ui){
                    console.info('remove event', event, ui);
                },
                success: function(event, ui){
                    console.info('success event', event, ui);
                },
                error: function(event, ui){
                    console.info('error event', event, ui);
                }
            });
        }
        instantiate();

        $('.acceptAllButton')
        .button()
        .hide()
        .click(function(){
            $('.content')
            .each(function(){
                $(this)
                .annotate('acceptAll', function(report){
                    console.log('AcceptAll finished with the report:', report);
                });
            })
            $('.acceptAllButton')
            .button('disable');
        });

        $('.enhanceButton')
        .button({enhState: 'passiv'})
        .click(function(){
            // Button with two states
            var oldState = $(this).button('option', 'enhState');
            var newState = oldState === 'passiv' ? 'active' : 'passiv';
            $('.enhanceButton').button('option', 'enhState', newState);
            if($(this).button('option', 'enhState') === 'active'){
                // annotate.enable()
                try {
                    console.info(".content", $('.content'));

                    enable()

                    $('.enhanceButton')
                    .button('disable')
                    .button('option', 'label', 'in progress...')
                } catch (e) {
                    alert(e);
                }

            } else {
                // annotate.disable()
                $('.content').annotate('disable');
                $('.enhanceButton').button('option', 'label', 'Enhance!');
                $('.acceptAllButton')
                .hide()
            }
        });
        jQuery('.instantiate').button().click(instantiate);
        jQuery('.destroy').button().click(function(){
            jQuery('.content').annotate('destroy');
        });
        jQuery('.enable').button().click(function(){
            enable();
        });
        jQuery('.disable').button().click(function(){
            jQuery('.content').annotate('disable');
        });
        jQuery('.listDom').button().click(function(){
            alert(jQuery('.content')[0].outerHTML);
        });
    });});
    </script>
  </head>
  <body  xmlns:sioc     = "http://rdfs.org/sioc/ns#"
         xmlns:skos     = "http://www.w3.org/2004/02/skos/core#"
         xmlns:schema   = "http://schema.org/">
        <div class="panel" id="webview">
            <h2>Test annotate.js - Europeana (needs special dataset in the connected stanbol)</h2>
            <button class="enhanceButton">Enhance!</button>
            <button class="acceptAllButton" style="display:none;">Accept all</button>
            <article typeof="schema:CreativeWork" about="http://stanbol.apache.org/enhancertest">
                <div property="sioc:content" class="content">
        Die ältesten Spuren der Anwesenheit von Menschen in Österreich gehören dem Mittelpaläolithikum, der Zeit der Neandertaler, an. Der Fundort mit den ältesten Spuren ist die Repolusthöhle in der Steiermark. Viele weitere Fundstellen liegen in Niederösterreich, die bekanntesten befinden sich in der Wachau – Darunter auch die Fundorte der beiden ältesten österreichischen Kunstwerke, die figürlichen Frauendarstellungen der sogenannten Tanzenden Fanny von Stratzing/Krems-Rehberg und der Venus von Willendorf.
Nach der schrittweisen Besiedelung aller Regionen Österreichs in der Jungsteinzeit steht die Kupfersteinzeit im Zeichen der Erschließung von Rohstoffvorkommen, vor allem Kupfer. Aus dieser Zeit stammt auch der Fund der berühmten Gletschermumie Ötzi im österreichisch-italienischen Grenzgebiet.
Während der Bronzezeit zwischen dem 3. und dem 1. Jahrtausend vor Christus wurden immer größere Handelszentren und auch Befestigungen, vorwiegend in Rohstoff-Abbaugebieten, errichtet. Im Umkreis von Hallstatt begann die systematische Gewinnung von Salz; nach diesem Ort ist auch die ältere Periode der Eisenzeit, die Hallstattzeit, benannt. Die jüngere Eisenzeit, auch La-Tène-Zeit genannt, steht im Zeichen der Kelten, welche im Süden und Osten des heutigen Österreich das erste Staatsgebilde errichteten – der Westen wurde zu dieser Zeit von Rätern besiedelt.
                </div>
            </article>
            <button class="enhanceButton">Enhance!</button>
            <button class="acceptAllButton" style="display:none;">Accept all</button>
			<br/>
			<h2>Images selected</h2>
			<div id="images"></div>
        </div>
        <div>
            <h2>Debug the widget states</h2>
            <button class="destroy">Destroy</button>
            <button class="instantiate">Instantiate</button>
            <button class="enable">Enable</button>
            <button class="disable">Disable</button>
            <button class="listDom">Show Dom Html</button>
        </div>
        <div id="loadingDiv" style="display:none;"><img src="spinner.gif"/></div>
    </body>
</html>
